<!DOCTYPE html>
<html lang="en">

<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>Appointment Form</title>
   <!-- <script src="script1.js" defer></script> -->

</head>

<body>
   <h1>Appointment Form</h1>
   <form id="appointment-form">
      <label for="userId">User ID:</label>
      <input type="text" id="userId" name="userId" required><br><br>
      <label for="appointment">Appointment Date:</label>
      <input type="date" id="appointment" name="appointment" required><br><br>
      <label for="appointment_name">Appointment Id:</label>
      <input type="text" id="appointmentId" name="appointment_name" required><br><br>
      <button type="button" onclick="submitForm(event)">Submit</button>
   </form>
</body>
<script defer>
   async function submitForm(event) {
      event.preventDefault();
      const userId = document.getElementById('userId').value;
      const appointmentDate = document.getElementById('appointment').value;
      const appointmentId = document.getElementById('appointmentId').value;

      const appointmentData = {
         userId: userId,
         appointment: appointmentDate,
         appointmentId: appointmentId
      };
      localStorage.setItem('userId', JSON.stringify(appointmentData));
      console.log('Appointment Data:', appointmentData);
      try {
         const result = await fetch('/generate-link', {
            method: 'POST',
            body: JSON.stringify(appointmentData),
            headers: {
               'Content-Type': 'application/json'
            }
         });
         let response = await result.json();
         if (response) {
            // Redirect to room page
            window.location.href = response.link;
         } else {
            // Handle error
            const errorMessage = await result.text();
            console.log('Error joining room:', errorMessage);
            // Display an error message to the user
         }
      } catch (error) {
         console.log('An error occurred:', error);
         // Handle error and display an error message to the user
      }
      // You can now use the appointmentData for further processing, like sending to a server, etc.
   }
</script>

</html>